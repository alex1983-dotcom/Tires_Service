{% extends "forum/base.html" %}

{% block content %}
<a href="{% url 'forum_home_page' %}" class="back-button">Назад на главную</a>
<div class="container">
    <h2>Сообщения в теме: {{ thread.title }}</h2>
    <ul>
        {% for post in posts %}
            <li>
                <p>{{ post.message }}</p>
                <p>Автор: {{ post.created_by.username }} | Дата: {{ post.created_at }}</p>
                {% if user.is_authenticated %}
                <a href="#" class="reply-link" data-post-id="{{ post.id }}">Ответить</a>
                <div class="reply-form" id="reply-form-{{ post.id }}" style="display: none;">
                    <form action="{% url 'post_list' thread.id %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="parent_id" value="{{ post.id }}">
                        <textarea name="content" rows="2" cols="50" placeholder="Напишите ваш ответ здесь..."></textarea>
                        <button type="submit">Отправить</button>
                    </form>
                </div>
                {% endif %}
                {% for reply in post.replies.all %}
                    <div class="reply">
                        <p>{{ reply.message }}</p>
                        <p>Автор: {{ reply.created_by.username }} | Дата: {{ reply.created_at }}</p>
                    </div>
                {% endfor %}
            </li>
        {% endfor %}
    </ul>
    {% if user.is_authenticated %}
    <form action="{% url 'post_list' thread.id %}" method="post">
        {% csrf_token %}
        <textarea name="content" rows="4" cols="50" placeholder="Напишите ваше сообщение здесь..."></textarea>
        <button type="submit">Отправить</button>
    </form>
    {% else %}
    <p>Пожалуйста, <a href="{% url 'login' %}">войдите</a>, чтобы оставлять сообщения.</p>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll('.reply-link').forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                const postId = this.getAttribute('data-post-id');
                const replyForm = document.getElementById(`reply-form-${postId}`);
                if (replyForm) {
                    replyForm.style.display = replyForm.style.display === 'none' ? 'block' : 'none';
                }
            });
        });
    });
</script>
{% endblock %}

<style>
    body {
        font-family: Arial, sans-serif;
        background-image: url('/media/колесо.jpg');
        background-size: cover;
        color: white;
        height: 100vh;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }
    .container {
        background: rgba(0, 0, 0, 0.7);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        width: 80%;
        max-width: 800px;
    }
    h2 {
        text-align: center;
    }
    .post-list ul {
        list-style-type: none;
        padding: 0;
    }
    .post-list li {
        background: rgba(255, 255, 255, 0.2);
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 5px;
    }
    .reply {
        margin-left: 20px;
        background-color: #e9ecef;
        padding: 10px;
        border-radius: 5px;
        color: black;
    }
    .reply-link {
        cursor: pointer;
        color: #007bff;
    }
    .reply-link:hover {
        text-decoration: underline;
    }
    .reply-form {
        margin-top: 10px;
    }
    .back-button {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        text-decoration: none;
    }
</style>
